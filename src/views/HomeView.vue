<template >
  <div class="container-fluid">
    <div class="row flex-wrap">
      <div
        class="d-none d-lg-block col-lg-1 border-end border-2 border-white shadow shadow-lg vh-100"
      >
        <navbar-view></navbar-view>
      </div>

      <div class="col-12 col-lg-8 px-24 ps-lg-40 pt-24">
        <div class="container">
          <div class="container px-0 d-flex mb-24 mb-lg-40">
            <div class="container ps-0">
              <h1 class="d-none d-md-block fs-40 noto-serif-tc fw-bold mb-16 pt-36">
                å°åŒ—å¸‚ä»Šæ—¥å¤©æ°£
              </h1>
              <h2 class="d-block d-md-none fs-40 noto-serif-tc fw-bold pt-24">å°åŒ—å¸‚</h2>
              <h2 class="d-block d-md-none fs-40 noto-serif-tc fw-bold">ä»Šæ—¥å¤©æ°£</h2>
              <p class="d-none d-md-block fs-24 mb-0">å¤©æ°£ç‹€æ³ï¼š{{ weatherDescription }}</p>
              <p class="d-none d-md-block fs-24 mb-0">æº«åº¦ï¼š {{ parseInt(temp) }} Â°C</p>
            </div>
            <div class="container mb-0 pe-0 d-flex justify-content-end">
              <img
                :src="weatherPic[weatherDescription]"
                alt="å¤©æ°£åœ–ç‰‡"
                class="d-none d-md-block"
                style="height: auto; max-height: 200px"
              />
              <img
                :src="weatherPic[weatherDescription]"
                alt="å¤©æ°£åœ–ç‰‡"
                class="d-block d-md-none"
                style="height: auto; max-height: 150px"
              />
            </div>
          </div>
        </div>

        <!-- ä»Šæ—¥å¤©æ°£ -->
        <div
          class="container d-flex px-0 justify-content-between flex-wrap align-items-center mt-lg-auto"
        >
          <div class="row justify-content-between gap-24 gap-lg-32">
            <div
              class="col-12 col-lg-5 border rounded rounded-3 ps-16 d-flex align-items-center justify-content-start shadow py-16 py-md-36"
            >
              <p class="fs-20 fs-xl-24 mb-0"><i class="bi bi-thermometer-half"></i> é«”æ„Ÿæº«åº¦ï¼š</p>
              <p class="fs-20 fs-xl-24 fw-bold mb-0">
                &nbsp;&nbsp;&nbsp;&nbsp;{{ parseInt(feelsLike) }} Â°C
              </p>
            </div>

            <div
              class="col-12 col-lg-5 border rounded rounded-3 ps-16 d-flex align-items-center justify-content-start shadow py-16 py-md-36"
            >
              <p class="fs-20 fs-xl-24 mb-0"><i class="bi bi-droplet"></i> æ¿•åº¦ï¼š</p>
              <p class="fs-20 fs-xl-24 fw-bold mb-0">&nbsp;&nbsp;&nbsp;&nbsp;{{ humidity }} %</p>
            </div>

            <div
              class="col-12 col-lg-5 border rounded rounded-3 ps-16 d-flex align-items-center justify-content-start shadow py-16 py-md-36"
            >
              <p class="fs-20 fs-xl-24 mb-0"><i class="bi bi-thermometer-sun"></i> æœ€é«˜æº«åº¦ï¼š</p>
              <p class="fs-20 fs-xl-24 fw-bold mb-0">
                &nbsp;&nbsp;&nbsp;&nbsp;{{ parseInt(tempMax) }} Â°C
              </p>
            </div>

            <div
              class="col-12 col-lg-5 border rounded rounded-3 ps-16 d-flex align-items-center justify-content-start shadow py-16 py-md-36"
            >
              <p class="fs-20 fs-xl-24 mb-0"><i class="bi bi-graph-up"></i> æ°£å£“ï¼š</p>
              <p class="fs-20 fs-xl-24 fw-bold mb-0">&nbsp;&nbsp;&nbsp;&nbsp;{{ pressure }} hPa</p>
            </div>

            <div
              class="col-12 col-lg-5 border rounded rounded-3 ps-16 d-flex justify-content-start align-items-center shadow py-16 py-md-36"
            >
              <p class="fs-20 fs-xl-24 mb-0"><i class="bi bi-thermometer-snow"></i> æœ€ä½æº«åº¦ï¼š</p>
              <p class="fs-20 fs-xl-24 fw-bold mb-0">
                &nbsp;&nbsp;&nbsp;&nbsp;{{ parseInt(tempMin) }} Â°C
              </p>
            </div>

            <div
              class="col-12 col-lg-5 border rounded rounded-3 ps-16 d-flex justify-content-start align-items-center shadow py-16 py-md-36"
            >
              <p class="fs-20 fs-xl-24 mb-0"><i class="bi bi-wind"></i> é¢¨é€Ÿï¼š</p>
              <p class="fs-20 fs-xl-24 fw-bold mb-0">&nbsp;&nbsp;&nbsp;&nbsp;{{ speed }} m/s</p>
            </div>
          </div>
        </div>
      </div>

      <div
        class="col-12 col-lg-3 pt-24 px-24 ps-lg-48 d-flex flex-column"
        style="min-height: 100vh"
      >
        <div class="container px-0 d-flex justify-content-between"></div>
        <!-- æ˜æ—¥é æ¸¬ -->
        <h2 class="fs-40 mb-24 noto-serif-tc fw-bold text-white">å°åŒ—å¸‚ä¸€é€±å¤©æ°£</h2>
        <div class="container mb-lg-60 mb-xxl-96">
          <p class="fs-24 mb-0">æ˜æ—¥å¤©æ°£ï¼š {{ nextWeatherDescription }}</p>
          <div class="container d-flex justify-content-between px-0">
            <!-- <div class="container px-0">
              <p class="mb-0 fw-bolder fs-24 d-lg-none d-xl-block">
                <i class="bi bi-thermometer-half " style="-webkit-text-stroke: 0.5px"></i
                >&nbsp;&nbsp;
              </p>
              <div class="container d-flex flex-xl-column px-0">
                <p class="d-lg-none">é«”æ„Ÿæº«åº¦ï¼š</p>
                <p class="mb-0 fs-16 fs-xl-24">{{ parseInt(nextDayFeelsLike) }} Â°C</p>
              </div>
            </div> -->

            <div class="container px-0">
              <div class="container d-flex px-0 justify-content-start flex-wrap">
                <p class="fs-24 mb-0">ä½æº«ï¼š</p>
                <p class="mb-0 fs-24">{{ parseInt(nextDayTempMin) }} Â°C</p>
              </div>
            </div>

            <div class="container px-0">
              <!-- <p class="mb-0 fw-bolder fs-24 d-lg-none d-xl-block">
                <i class="bi bi-thermometer-sun" style="-webkit-text-stroke: 0.5px"></i>&nbsp;&nbsp;
              </p> -->
              <div class="container d-flex px-0 justify-content-end flex-wrap">
                <p class="fs-24 mb-0">é«˜æº«ï¼š</p>
                <p class="mb-0 fs-24">{{ parseInt(nextDayTempMax) }} Â°C</p>
              </div>
            </div>
          </div>
        </div>

        <!-- ä¸€é€±é æ¸¬ -->
        <div
          class="container px-0 d-flex flex-column justify-content-between border border-2 rounded rounded-3 "
        >
          <div class="container border-bottom border-2">
            <div class="container d-flex py-16 py-xxl-20 mb-0 justify-content-between pe-24">
              <!-- todo å„ªåŒ– RWD UI -->
              <p class="fs-20 fs-md-24 mb-0 d-block d-lg-none d-xl-block">
                {{ forecastDays.day1 ? forecastDays.day1.substr(5, 5) : '' }} :&nbsp;&nbsp;
              </p>
              <p class="fs-20 fs-md-24 mb-0">
                {{
                  weatherEmoji[
                    forecastDescription.day1 ? forecastDescription.day1[0].description : ''
                  ]
                }}
              </p>

              <p class="d-block d-lg-none d-xl-block fs-20 fs-md-24 mb-0">
                {{ forecastWeather.day1 ? parseInt(forecastWeather.day1.temp_max) : '' }}/
                {{ forecastWeather.day1 ? parseInt(forecastWeather.day1.temp_min) : '' }}
              </p>
            </div>
          </div>

          <div class="container border-bottom border-2">
            <div class="container d-flex py-16 py-xxl-20 mb-0 justify-content-between pe-24">
              <p class="fs-20 fs-md-24 mb-0 d-block d-lg-none d-xl-block">
                {{ forecastDays.day2 ? forecastDays.day2.substr(5, 5) : '' }} :&nbsp; &nbsp;
              </p>
              <p class="fs-20 fs-md-24 mb-0">
                {{
                  weatherEmoji[
                    forecastDescription.day2 && forecastDescription.day2[0]
                      ? forecastDescription.day2[0].description
                      : ''
                  ]
                }}
              </p>

              <p class="d-block d-lg-none fs-20 fs-md-24 mb-0">
                {{ forecastWeather.day2 ? parseInt(forecastWeather.day2.temp_max) : '' }}/
                {{ forecastWeather.day2 ? parseInt(forecastWeather.day2.temp_min) : '' }}
              </p>
            </div>
          </div>

          <div class="container border-bottom border-2">
            <div class="container d-flex py-16 py-xxl-20 mb-0 justify-content-between pe-24">
              <p class="fs-20 fs-md-24 mb-0 d-block d-lg-none d-xl-block">
                {{ forecastDays.day3 ? forecastDays.day3.substr(5, 5) : '' }} :&nbsp; &nbsp;
              </p>
              <p class="fs-20 fs-md-24 mb-0">
                {{
                  weatherEmoji[
                    forecastDescription.day3 && forecastDescription.day3[0]
                      ? forecastDescription.day3[0].description
                      : ''
                  ]
                }}
              </p>

              <p class="d-block d-lg-none fs-20 fs-md-24 mb-0">
                {{ forecastWeather.day3 ? parseInt(forecastWeather.day3.temp_max) : '' }}/
                {{ forecastWeather.day3 ? parseInt(forecastWeather.day3.temp_min) : '' }}
              </p>
            </div>
          </div>

          <div class="container border-bottom border-2">
            <div class="container d-flex py-16 py-xxl-20 mb-0 justify-content-between pe-24">
              <p class="fs-20 fs-md-24 mb-0 d-block d-lg-none d-xl-block">
                {{ forecastDays.day4 ? forecastDays.day4.substr(5, 5) : '' }} :&nbsp; &nbsp;
              </p>
              <p class="fs-20 fs-md-24 mb-0">
                {{
                  forecastDescription.day4 && forecastDescription.day4[0]
                    ? weatherEmoji[forecastDescription.day4[0].description]
                    : ''
                }}
              </p>

              <p class="d-block d-lg-none fs-20 fs-md-24 mb-0">
                {{ forecastWeather.day4 ? parseInt(forecastWeather.day4.temp_max) : '' }}/
                {{ forecastWeather.day4 ? parseInt(forecastWeather.day4.temp_min) : '' }}
              </p>
            </div>
          </div>

          <div class="container">
            <div class="container d-flex py-16 py-xxl-20 mb-0 justify-content-between pe-24">
              <p class="fs-20 fs-md-24 mb-0 d-block d-lg-none d-xl-block">
                {{ forecastDays.day5 ? forecastDays.day5.substr(5, 5) : '' }} :&nbsp; &nbsp;
              </p>
              <p class="fs-20 fs-md-24 mb-0">
                {{
                  forecastDescription.day5 && forecastDescription.day5[0]
                    ? weatherEmoji[forecastDescription.day5[0].description]
                    : ''
                }}
              </p>

              <p class="fs-20 fs-md-24 d-block d-lg-none">
                {{ forecastWeather.day5 ? parseInt(forecastWeather.day5.temp_max) : '' }}/
                {{ forecastWeather.day5 ? parseInt(forecastWeather.day5.temp_min) : '' }}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import '@/components/NavbarView.vue'
import NavbarView from '@/components/NavbarView.vue'

export default {
  components: { NavbarView },
  data() {
    return {
      apiKey: import.meta.env.VITE_API_KEY,
      weatherDescription: null,
      temp: null,
      feelsLike: null, // é«”æ„Ÿæº«åº¦
      tempMin: null, // æœ€ä½æº«åº¦
      tempMax: null, // æœ€é«˜æº«åº¦
      pressure: null, // æ°£å£“
      humidity: null, // æ¿•åº¦
      speed: null, // é¢¨é€Ÿ
      name: null, // åŸå¸‚åç¨±
      nextDayTemp: null,
      nextDayFeelsLike: null,
      nextDayTempMin: null,
      nextDayTempMax: null,
      nextDayPressure: null,
      nextDayHumidity: null,
      nextDaySpeed: null,
      nextDayName: null,
      nextWeatherDescription: null,
      todayDate: new Date(),
      fiveDaysForecast: null,
      forecastData: null,
      todayDays: null,
      weatherEmoji: {
        å°é›¨: 'ğŸ’§ ',
        ä¸­é›¨: 'ğŸŒ§ï¸',
        å¤šé›²: 'ğŸŒ¥ï¸',
        'é™°ï¼Œå¤šé›²': 'â˜ï¸',
        æ™´: 'â˜€ï¸',
        é™°: 'ğŸŒ«ï¸',
        é›·é›¨: 'â›ˆï¸',
        å¤§é›¨: 'ğŸŒ§ï¸',
        é™£é›¨: 'ğŸŒ¦ï¸',
        é›ª: 'â„ï¸',
        éœ§: 'ğŸŒ«ï¸',
        'æ™´ï¼Œå°‘é›²': 'ğŸŒ¤ï¸',
      },
      weatherPic: {
        å°é›¨: 'https://cdn-icons-png.flaticon.com/512/1779/1779927.png',
        ä¸­é›¨: 'https://cdn-icons-png.flaticon.com/512/1146/1146858.png',
        å¤šé›²: 'https://cdn-icons-png.flaticon.com/512/414/414927.png',
        'é™°ï¼Œå¤šé›²': 'https://cdn-icons-png.flaticon.com/512/1146/1146869.png',
        æ™´: 'https://cdn-icons-png.flaticon.com/512/979/979585.png',
        é™°: 'https://cdn-icons-png.flaticon.com/512/1146/1146856.png',
        é›·é›¨: 'https://cdn-icons-png.flaticon.com/512/1146/1146860.png',
        å¤§é›¨: 'https://cdn-icons-png.flaticon.com/512/1146/1146859.png',
        é™£é›¨: 'https://cdn-icons-png.flaticon.com/512/1163/1163657.png',
        é›ª: 'https://cdn-icons-png.flaticon.com/512/642/642000.png',
        éœ§: 'https://cdn-icons-png.flaticon.com/512/1197/1197102.png',
      },
      forecastDays: {
        day1: null,
        day2: null,
        day3: null,
        day4: null,
        day5: null,
      },
      forecastWeather: {
        day1: null,
        day2: null,
        day3: null,
        day4: null,
        day5: null,
      },
      forecastDescription: {
        day1: null,
        day2: null,
        day3: null,
        day4: null,
        day5: null,
      },
    }
  },

  methods: {
    async getCurrentWeather() {
      try {
        const res = await this.$http.get(
          `https://api.openweathermap.org/data/2.5/weather?q=Taipei,TW&appid=${this.apiKey}&units=metric&lang=zh_tw`
        )
        this.weatherDescription = res.data.weather[0].description
        this.temp = res.data.main.temp
        this.feelsLike = res.data.main.feels_like // é«”æ„Ÿæº«åº¦
        this.tempMin = res.data.main.temp_min // æœ€ä½æº«åº¦
        this.tempMax = res.data.main.temp_max // æœ€é«˜æº«åº¦
        this.pressure = res.data.main.pressure // æ°£å£“
        this.humidity = res.data.main.humidity // æ¿•åº¦
        this.speed = res.data.wind.speed // é¢¨é€Ÿ
        this.name = res.data.name // åŸå¸‚åç¨±
      } catch (err) {
        console.log(err.message)
      }
    },

    async getNextDayForecast() {
      try {
        const res = await this.$http.get(
          `https://api.openweathermap.org/data/2.5/weather?q=Taipei&appid=${this.apiKey}&units=metric&lang=zh_tw`
        )
        this.nextDayTemp = res.data.main.temp
        this.nextDayFeelsLike = res.data.main.feels_like
        this.nextDayTempMin = res.data.main.temp_min
        this.nextDayTempMax = res.data.main.temp_max
        this.nextDayPressure = res.data.main.pressure
        this.nextDayHumidity = res.data.main.humidity
        this.nextDaySpeed = res.data.wind.speed
        this.nextDayName = res.data.name
        this.nextWeatherDescription = res.data.weather[0].description
      } catch (err) {
        console.log(err.message)
      }
    },

    async getFiveDayForecast() {
      const loader = this.$loading.show()
      try {
        const res = await this.$http.get(
          `https://api.openweathermap.org/data/2.5/forecast?q=Taipei&units=metric&lang=zh_tw&appid=${this.apiKey}`
        )
        this.forecastData = res.data.list
        let j = 1
        for (let i = 0; i < this.forecastData.length; i++) {
          if (this.forecastData[i].dt_txt.includes('00:00:00')) {
            this.forecastDays['day' + [j]] = this.forecastData[i].dt_txt
            this.forecastWeather['day' + [j]] = this.forecastData[i].main
            this.forecastDescription['day' + [j]] = this.forecastData[i].weather
            j++
          }
        }
      } catch (err) {
        alert(err.message)
      }
      setTimeout(() => {
        loader.hide()
      }, 1000)
    },

    convertTimeStamp2LocalTime(timeStamp) {
      const date = new Date(timeStamp * 1000)
      return date.toLocaleString('zh-Tw', {
        timeZone: 'Asia/Taipei',
      })
    },

    convert2WeatherEmoji(weather) {
      return this.weatherEmoji(weather)
    },
  },

  mounted() {
    this.getCurrentWeather()
    this.getNextDayForecast()
    this.getFiveDayForecast()
  },
}
</script>